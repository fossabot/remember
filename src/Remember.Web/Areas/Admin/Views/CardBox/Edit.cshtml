@model Remember.Domain.CardBox
@{
    ViewBag.Title = "Edit";
}

<link href="~/dist/layui/css/layui.css" rel="stylesheet" />

<div style="text-align: center;">
    <button class="layui-btn layui-btn-sm" onclick="onSubmit()">保存</button>
    <button class="layui-btn layui-btn-sm" onclick="onCancel()">取消</button>
</div>
<form class="layui-form">
    @Html.HiddenFor(model => model.ID)
    <div class="layui-form-item">
        @Html.LabelFor(model => model.Name, new { @class = "layui-form-label" })
        <div class="layui-input-block">
            @Html.TextBoxFor(model => model.Name, new { @class = "layui-input", placeholder = "请输入" + Html.DisplayNameFor(m => m.Name), autocomplete = "off", Value = Model.Name })
        </div>
    </div>
    <div class="layui-form-item">
        @Html.LabelFor(model => model.Description, new { @class = "layui-form-label" })
        <div class="layui-input-block">
            @Html.TextAreaFor(model => model.Description, new { @class = "layui-input", placeholder = "请输入" + Html.DisplayNameFor(m => m.Description), autocomplete = "off", Value = Model.Description })
        </div>
    </div>
</form>

<script src="~/dist/layui/layui.js"></script>
<script src="~/dist/jquery/jquery-3.3.1.min.js"></script>
<script>
    layui.use(['form', 'layer'], function () {
        form = layui.form
        , layer = layui.layer;
    });

    function onSubmit() {
        // 1.验证输入
        // 1.1 盒名
        if ($("#Name").val().trim() == "") {
            layer.msg("请输入盒名")
            $("#Name").focus();
            return;
        }
        if (getByteLen($("#Name").val().trim()) > 30) {
            layer.msg("盒名不能超过30个字符");
            $("#Name").focus();
            return;
        }
        // 1.2 描述
        if ($("#Description").val().trim() == "") {
            layer.msg("请输入描述");
            $("#Description").focus();
            return;
        }
        if (getByteLen($("#Description").val().trim()) > 500) {
            layer.msg("描述不能超过500个字符");
            $("#Description").focus();
            return;
        }
        // 2.提交数据
        $.ajax({
            type: "post",
            url: "/CardBox/Edit",
            data: $("form").serialize(),
            dataType: "json",
            success: function (data) {
                if (data.code == 1) {
                    // 提交成功
                    // 3.关闭弹窗
                    parent.layer.close(parent.layer.index);
                } else if(data.code == -1) {
                    // 提交失败
                    layer.msg(data.message);
                }
            }
        });
    }

    function onCancel() {
        // 关闭弹窗
        parent.layer.close(parent.layer.index);
    }

    // 求字符串长度——汉字算2
    function getByteLen(val) {
        var len = 0;
        for (var i = 0; i < val.length; i++) {
            var a = val.charAt(i);
            if (a.match(/[^\x00-\xff]/ig) != null) {
                len += 2;
            } else {
                len += 1;
            }
        }
        return len;
    }
</script>